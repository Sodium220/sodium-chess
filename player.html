<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Player Dashboard - Sodium</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00d2ff; --bg: #050a12; --card: #101926; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: var(--card); border-radius: 15px; margin-bottom: 30px; }
        
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 25px; max-width: 1000px; margin: 0 auto 40px; }
        .stat-card { background: var(--card); padding: 30px; border-radius: 15px; text-align: center; border: 1px solid #1e2d41; transition: 0.3s; }
        .stat-card:hover { transform: translateY(-10px); border-color: var(--primary); }
        .stat-card i { font-size: 35px; color: var(--primary); margin-bottom: 15px; }
        .stat-card h2 { font-size: 32px; margin: 0; }
        .stat-label { color: #8a99af; font-size: 14px; text-transform: uppercase; margin-top: 5px; }

        .bracket-view { background: rgba(16,25,38,0.8); padding: 40px; border-radius: 20px; overflow-x: auto; border: 1px solid #1e2d41; }
        .bracket-wrapper { display: flex; gap: 50px; }
        .round-col { display: flex; flex-direction: column; justify-content: space-around; min-width: 200px; }
        .m-box { background: #1c2c3e; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #34495e; }
        .p-name { padding: 5px 0; border-bottom: 1px solid #2a3a4d; font-size: 15px; }
        .p-name:last-child { border-bottom: none; }

        .win-status { color: #2ed573; font-weight: bold; }
        .lose-status { text-decoration: line-through; color: #5d6d7e; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h1 style="margin:0;">Dashboard</h1>
        <p style="margin:0; color:var(--primary);">Welcome back, <span id="displayUser">...</span></p>
    </div>
    <button onclick="logout()" style="background:#ff4757; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold;">Logout</button>
</div>

<div class="stats-row">
    <div class="stat-card">
        <i class="fas fa-play-circle"></i>
        <h2 id="totalM">0</h2>
        <div class="stat-label">Total Matches</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-medal" style="color: #ffca28;"></i>
        <h2 id="wins">0</h2>
        <div class="stat-label">Wins</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-skull" style="color: #ff4757;"></i>
        <h2 id="losses">0</h2>
        <div class="stat-label">Losses</div>
    </div>
</div>

<div class="bracket-view">
    <h2 style="text-align:center; margin-bottom:30px;"><i class="fas fa-sitemap"></i> Live Tournament Bracket</h2>
    <div class="bracket-wrapper" id="player-bracket">
        </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://sodium-chess-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const me = localStorage.getItem("username");
    if(!me) location.href = 'index.html';
    document.getElementById('displayUser').innerText = me;

    // 1. Fetch Stats
    db.ref('users/' + me + '/stats').on('value', snap => {
        const s = snap.val() || {wins: 0, total: 0};
        document.getElementById('wins').innerText = s.wins;
        document.getElementById('totalM').innerText = s.total;
        document.getElementById('losses').innerText = s.total - s.wins;
    });

    // 2. Fetch Bracket
    db.ref('tournament_tree').on('value', snap => {
        const root = document.getElementById('player-bracket');
        root.innerHTML = "";
        const data = snap.val();
        if(!data) return root.innerHTML = "<p style='width:100%; text-align:center;'>Tournament hasn't started yet.</p>";

        data.forEach(round => {
            const col = document.createElement('div');
            col.className = 'round-col';
            round.forEach(m => {
                col.innerHTML += `
                <div class="m-box">
                    <div class="p-name ${m.s1}">${m.p1 || "---"}</div>
                    <div class="p-name ${m.s2}">${m.p2 || "---"}</div>
                </div>`;
            });
            root.appendChild(col);
        });
    });

    function logout() { localStorage.clear(); location.href='index.html'; }
</script>
</body>
</html>
