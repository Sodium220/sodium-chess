<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Sodium Chess</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #1a1a2e; color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        .stats-row { background: #16213e; padding: 20px; border-radius: 12px; display: flex; justify-content: space-around; margin-bottom: 25px; border: 1px solid #e94560; }
        .match-card { background: #0f3460; padding: 15px; margin: 10px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        button { border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
        .btn-play { background: #e94560; }
        .btn-view { background: #24a0ed; }
    </style>
</head>
<body>
    <div class="container">
        <h2 id="userName">স্বাগতম!</h2>
        <div class="stats-row">
            <div><h2 id="winCount">0</h2><p>Wins</p></div>
            <div><h2 id="totalCount">0</h2><p>Games Played</p></div>
        </div>

        <h3>টুর্নামেন্ট ব্র্যাকেট (লাইভ):</h3>
        <div id="bracket"></div>
        <button onclick="localStorage.clear(); location.href='index.html'" style="margin-top:20px; background:gray">Logout</button>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://sodium-chess-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const me = localStorage.getItem("username");
    if(!me) location.href = "index.html";
    document.getElementById('userName').innerText = "হ্যালো, " + me;

    // লোড স্ট্যাটাস
    db.ref('users/' + me + '/stats').on('value', snap => {
        const s = snap.val() || {wins:0, total:0};
        document.getElementById('winCount').innerText = s.wins;
        document.getElementById('totalCount').innerText = s.total;
    });

    // ব্র্যাকেট লোড
    db.ref('matches').on('value', snap => {
        const b = document.getElementById('bracket');
        b.innerHTML = "";
        const data = snap.val();
        if(!data) return b.innerHTML = "কোনো ম্যাচ তৈরি হয়নি।";
        Object.keys(data).forEach(k => {
            const m = data[k];
            const isMyMatch = (m.p1 === me || m.p2 === me);
            b.innerHTML += `<div class="match-card">
                <span><b>${m.p1}</b> vs <b>${m.p2}</b></span>
                <button class="${isMyMatch ? 'btn-play' : 'btn-view'}" onclick="location.href='game.html?id=${k}'">
                    ${isMyMatch ? 'Play Match' : 'Watch Live'}
                </button>
            </div>`;
        });
    });
</script>
</body>
</html>
