<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Player Dashboard - Sodium Chess</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00d2ff; --bg: #050a12; --card: #101926; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 40px; }
        .grid-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px auto; max-width: 900px; }
        
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #222; transition: 0.3s; }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .stat-card i { font-size: 30px; color: var(--primary); margin-bottom: 10px; }
        .stat-card h2 { margin: 5px 0; font-size: 28px; }
        
        .bracket-container { background: rgba(16, 25, 38, 0.5); padding: 30px; border-radius: 20px; margin-top: 40px; overflow-x: auto; }
        .bracket-wrapper { display: flex; gap: 50px; }
        .round-col { display: flex; flex-direction: column; justify-content: space-around; min-width: 180px; }
        .match-card { background: #1a2433; padding: 10px; border-radius: 8px; margin: 10px 0; border: 1px solid #333; }
        .p-view { padding: 8px; font-size: 14px; border-bottom: 1px solid #222; }
        .p-view:last-child { border-bottom: none; }
        
        .win { color: #2ed573; font-weight: bold; }
        .lose { text-decoration: line-through; color: #555; }
    </style>
</head>
<body>

<div class="header">
    <h1>Welcome, <span id="pName" style="color: var(--primary);">...</span></h1>
    <button onclick="logout()" style="background:red; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">Logout</button>
</div>

<div class="grid-stats">
    <div class="stat-card">
        <i class="fas fa-gamepad"></i>
        <p>Total Matches</p>
        <h2 id="totalM">0</h2>
    </div>
    <div class="stat-card">
        <i class="fas fa-trophy"></i>
        <p>Wins</p>
        <h2 id="wins" style="color: #2ed573;">0</h2>
    </div>
    <div class="stat-card">
        <i class="fas fa-times-circle"></i>
        <p>Losses</p>
        <h2 id="losses" style="color: #ff4757;">0</h2>
    </div>
</div>

<div class="bracket-container">
    <h2 style="text-align: center; color: var(--primary);"><i class="fas fa-sitemap"></i> Tournament Bracket</h2>
    <div class="bracket-wrapper" id="bracket-root"></div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://sodium-chess-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const user = localStorage.getItem("username");
    if(!user) location.href = 'index.html';
    document.getElementById('pName').innerText = user;

    // Load Stats
    db.ref('users/'+user+'/stats').on('value', snap => {
        const s = snap.val() || {wins:0, total:0};
        document.getElementById('wins').innerText = s.wins;
        document.getElementById('totalM').innerText = s.total;
        document.getElementById('losses').innerText = s.total - s.wins;
    });

    // Load Bracket
    db.ref('tournament_tree').on('value', snap => {
        const root = document.getElementById('bracket-root');
        root.innerHTML = "";
        const data = snap.val();
        if(!data) return root.innerHTML = "<p style='text-align:center; width:100%'>No tournament live.</p>";

        data.forEach(round => {
            const col = document.createElement('div');
            col.className = 'round-col';
            round.forEach(m => {
                col.innerHTML += `
                <div class="match-card">
                    <div class="p-view ${m.s1}">${m.p1 || "---"}</div>
                    <div class="p-view ${m.s2}">${m.p2 || "---"}</div>
                </div>`;
            });
            root.appendChild(col);
        });
    });

    function logout() { localStorage.clear(); location.href='index.html'; }
</script>
</body>
</html>
