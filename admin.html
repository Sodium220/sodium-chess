<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Sodium Chess</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #00d2ff; --bg: #050a12; --card: #101926; --accent: #2ed573; --danger: #ff4757; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: var(--card); height: 100vh; padding: 20px; border-right: 1px solid #222; position: fixed; }
        .sidebar h2 { color: var(--primary); text-align: center; }
        .nav-btn { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; background: #1a2433; color: white; cursor: pointer; text-align: left; transition: 0.3s; }
        .nav-btn:hover { background: var(--primary); color: #000; transform: translateX(5px); }

        /* Main Content */
        .main { margin-left: 270px; padding: 30px; width: 100%; }
        .glass-card { background: rgba(16, 25, 38, 0.8); backdrop-filter: blur(10px); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 30px; }

        /* Bracket UI */
        .bracket-wrapper { display: flex; gap: 60px; padding: 40px 0; overflow-x: auto; }
        .round-col { display: flex; flex-direction: column; justify-content: space-around; min-width: 220px; }
        .match-card { background: var(--card); border: 1px solid #333; border-radius: 10px; margin: 15px 0; position: relative; transition: 0.3s; }
        .match-card:hover { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 210, 255, 0.1); }
        
        .p-slot { padding: 12px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; height: 35px; }
        .p-slot:last-child { border-bottom: none; }
        .p-slot input { background: transparent; border: none; color: #fff; width: 70%; font-size: 14px; outline: none; }
        
        /* Controls */
        .actions { opacity: 0; transition: 0.2s; display: flex; gap: 10px; }
        .p-slot:hover .actions { opacity: 1; }
        .btn-check { color: var(--accent); cursor: pointer; }
        .btn-cross { color: var(--danger); cursor: pointer; }

        /* States */
        .eliminated { text-decoration: line-through; color: #555 !important; }
        .winner-text { color: var(--accent) !important; font-weight: bold; }

        /* Lines */
        .match-card::after { content: ""; position: absolute; right: -30px; top: 50%; width: 30px; height: 2px; background: #333; }
        .round-col:last-child .match-card::after { display: none; }

        input[type="number"] { padding: 10px; border-radius: 5px; border: 1px solid #333; background: #1a2433; color: white; width: 100px; }
        .btn-main { background: var(--primary); color: #000; padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2><i class="fas fa-chess-king"></i> SODIUM</h2>
    <button class="nav-btn" onclick="showSec('dashboard')"><i class="fas fa-home"></i> Dashboard</button>
    <button class="nav-btn" onclick="showSec('bracket')"><i class="fas fa-sitemap"></i> Tournament Bracket</button>
    <button class="nav-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
</div>

<div class="main">
    <div id="dashboard" class="section">
        <div class="glass-card">
            <h1>Admin Dashboard</h1>
            <p>নতুন গেম হোস্ট করুন অথবা ব্র্যাকেট ম্যানেজ করুন।</p>
        </div>
    </div>

    <div id="bracket" class="section" style="display:none;">
        <div class="glass-card">
            <h3>Bracket Generator</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="number" id="playerCount" placeholder="Players" min="2" value="8">
                <button class="btn-main" onclick="genBracket()">Generate Tree</button>
                <button onclick="resetBrk()" style="background:transparent; color:red; border:1px solid red; padding:8px; border-radius:5px; cursor:pointer;">Reset</button>
            </div>
        </div>

        <div class="bracket-wrapper" id="bracket-view"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://sodium-chess-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const bRef = db.ref('tournament_tree');

    function showSec(id) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function genBracket() {
        const n = parseInt(document.getElementById('playerCount').value);
        if((n & (n - 1)) !== 0) return alert("Please enter power of 2 (2, 4, 8, 16, 32)");
        
        let rounds = [];
        let mCount = n / 2;
        let rIdx = 0;
        while(mCount >= 1) {
            let matches = [];
            for(let i=0; i<mCount; i++) {
                matches.push({ id: `R${rIdx}_M${i}`, p1: rIdx==0?`P${i*2+1}`:"", p2: rIdx==0?`P${i*2+2}`:"", s1:"", s2:"" });
            }
            rounds.push(matches);
            mCount /= 2;
            rIdx++;
        }
        bRef.set(rounds);
    }

    function resetBrk() { if(confirm("Clear Bracket?")) bRef.remove(); }

    bRef.on('value', snap => {
        const root = document.getElementById('bracket-view');
        root.innerHTML = "";
        const data = snap.val();
        if(!data) return;

        data.forEach((round, rIdx) => {
            const col = document.createElement('div');
            col.className = 'round-col';
            round.forEach((m, mIdx) => {
                col.innerHTML += `
                <div class="match-card">
                    <div class="p-slot ${m.s1}">
                        <input type="text" class="${m.s1==='win'?'winner-text':''}" value="${m.p1}" onchange="upName(${rIdx},${mIdx},'p1',this.value)">
                        <div class="actions">
                            <i class="fas fa-check btn-check" onclick="setWin(${rIdx},${mIdx},'p1','${m.p1}')"></i>
                            <i class="fas fa-times btn-cross" onclick="setLose(${rIdx},${mIdx},'p1')"></i>
                        </div>
                    </div>
                    <div class="p-slot ${m.s2}">
                        <input type="text" class="${m.s2==='win'?'winner-text':''}" value="${m.p2}" onchange="upName(${rIdx},${mIdx},'p2',this.value)">
                        <div class="actions">
                            <i class="fas fa-check btn-check" onclick="setWin(${rIdx},${mIdx},'p2','${m.p2}')"></i>
                            <i class="fas fa-times btn-cross" onclick="setLose(${rIdx},${mIdx},'p2')"></i>
                        </div>
                    </div>
                </div>`;
            });
            root.appendChild(col);
        });
    });

    function upName(r, m, p, v) { bRef.child(`${r}/${m}/${p}`).set(v); }
    function setLose(r, m, p) { bRef.child(`${r}/${m}/${p==='p1'?'s1':'s2'}`).set('eliminated'); }
    
    function setWin(r, m, p, name) {
        bRef.child(`${r}/${m}/${p==='p1'?'s1':'s2'}`).set('win');
        bRef.once('value', s => {
            const rds = s.val();
            if(r + 1 < rds.length) {
                const nextM = Math.floor(m/2);
                const nextP = (m%2===0) ? 'p1' : 'p2';
                bRef.child(`${r+1}/${nextM}/${nextP}`).set(name);
            }
        });
    }

    function logout() { localStorage.clear(); location.href='index.html'; }
</script>
</body>
</html>
